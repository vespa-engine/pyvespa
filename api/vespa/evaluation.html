
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="deployment.html">
      
      
        <link rel="next" href="exceptions.html">
      
      
      <link rel="icon" href="../../_static/logo-symbol/Vespa-isolated-symbol-white-rgb.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Evaluation - Vespa python API</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:300,300i,400,400i,700,700i%7CRed+Hat+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Merriweather Sans";--md-code-font:"Red Hat Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="yellow">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vespa.evaluation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Vespa python API" class="md-header__button md-logo" aria-label="Vespa python API" data-md-component="logo">
      
  <img src="../../_static/logo/Vespa-logo-white-rgb.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vespa python API
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Evaluation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="yellow"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="deep-purple"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/vespa-engine/pyvespa" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Vespa python API" class="md-nav__button md-logo" aria-label="Vespa python API" data-md-component="logo">
      
  <img src="../../_static/logo/Vespa-logo-white-rgb.svg" alt="logo">

    </a>
    Vespa python API
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vespa-engine/pyvespa" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started-pyvespa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hybrid Search - Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started-pyvespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hybrid Search - Quickstart on Vespa Cloud
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced Configuration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authenticating-to-vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authenticating to Vespa Cloud
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../application-packages.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application packages
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Querying Vespa
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reads-writes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read and write operations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluating-vespa-application-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evaluating a Vespa Application
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/Matryoshka_embeddings_in_Vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Matryoshka embeddings in Vespa cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/billion-scale-vector-search-with-cohere-embeddings-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Billion scale vector search with cohere embeddings cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/chat_with_your_pdfs_using_colbert_langchain_and_Vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    chat with your pdfs using colbert langchain and Vespa cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/cohere-binary-vectors-in-vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohere binary vectors in vespa cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/colbert_standalone_Vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    colbert standalone Vespa cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/colbert_standalone_long_context_Vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    colbert standalone long context Vespa cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/colpali-benchmark-vqa-vlm_Vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    colpali benchmark vqa vlm Vespa cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/colpali-document-retrieval-vision-language-models-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Colpali document retrieval vision language models cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/cross-encoders-for-global-reranking.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cross encoders for global reranking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/evaluating-with-snowflake-arctic-embed.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evaluating with snowflake arctic embed
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/feed_performance.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feed performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/feed_performance_cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feed performance cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/lightgbm-with-categorical-mapping.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lightgbm with categorical mapping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/lightgbm-with-categorical.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lightgbm with categorical
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/mixedbread-binary-embeddings-with-sentence-transformers-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mixedbread binary embeddings with sentence transformers cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/mother-of-all-embedding-models-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mother of all embedding models cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/multi-vector-indexing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi vector indexing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/multilingual-multi-vector-reps-with-cohere-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multilingual multi vector reps with cohere cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/pdf-retrieval-with-ColQwen2-vlm_Vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pdf retrieval with ColQwen2 vlm Vespa cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/pyvespa-examples.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pyvespa examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/rag-blueprint-vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rag blueprint vespa cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/scaling-personal-ai-assistants-with-streaming-mode-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scaling personal ai assistants with streaming mode cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/simplified-retrieval-with-colpali-vlm_Vespa-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    simplified retrieval with colpali vlm Vespa cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/turbocharge-rag-with-langchain-and-vespa-streaming-mode-cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Turbocharge rag with langchain and vespa streaming mode cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/video_search_twelvelabs_cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Video search twelvelabs cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/visual_pdf_rag_with_vespa_colpali_cloud.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visual pdf rag with vespa colpali cloud
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" checked>
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="application.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deployment.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Evaluation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="evaluation.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Evaluation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vespa.evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.RandomHitsSamplingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RandomHitsSamplingStrategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluatorBase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaEvaluatorBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaEvaluatorBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluatorBase.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluatorBase.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluator.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaMatchEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaMatchEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaMatchEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaMatchEvaluator.create_grouping_filter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_grouping_filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaMatchEvaluator.extract_matched_ids" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;extract_matched_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaMatchEvaluator.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaCollectorBase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaCollectorBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaCollectorBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaCollectorBase.collect" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;collect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaCollectorBase.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaFeatureCollector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaFeatureCollector
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaFeatureCollector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaFeatureCollector.get_recall_param" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_recall_param
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaFeatureCollector.calculate_random_hits_count" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;calculate_random_hits_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaFeatureCollector.collect" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;collect
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.mean" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.percentile" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;percentile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.validate_queries" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;validate_queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.validate_qrels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;validate_qrels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.validate_vespa_query_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;validate_vespa_query_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.filter_queries" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;filter_queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.extract_doc_id_from_hit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;extract_doc_id_from_hit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.get_id_field_from_hit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_id_field_from_hit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.calculate_searchtime_stats" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;calculate_searchtime_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.execute_queries" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;execute_queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.write_csv" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.log_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;log_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.extract_features_from_hit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;extract_features_from_hit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exceptions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="io.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="package.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Package
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_7" >
        
          
          <label class="md-nav__link" for="__nav_11_7" id="__nav_11_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Querybuilder
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_7">
            <span class="md-nav__icon md-icon"></span>
            Querybuilder
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="querybuilder/grouping/grouping.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grouping
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vespa.evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.RandomHitsSamplingStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RandomHitsSamplingStrategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluatorBase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaEvaluatorBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaEvaluatorBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluatorBase.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluatorBase.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaEvaluator.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaMatchEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaMatchEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaMatchEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaMatchEvaluator.create_grouping_filter" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_grouping_filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaMatchEvaluator.extract_matched_ids" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;extract_matched_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaMatchEvaluator.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaCollectorBase" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaCollectorBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaCollectorBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaCollectorBase.collect" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;collect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaCollectorBase.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaFeatureCollector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;VespaFeatureCollector
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" VespaFeatureCollector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaFeatureCollector.get_recall_param" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_recall_param
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaFeatureCollector.calculate_random_hits_count" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;calculate_random_hits_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.VespaFeatureCollector.collect" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;collect
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.mean" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.percentile" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;percentile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.validate_queries" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;validate_queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.validate_qrels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;validate_qrels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.validate_vespa_query_fn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;validate_vespa_query_fn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.filter_queries" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;filter_queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.extract_doc_id_from_hit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;extract_doc_id_from_hit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.get_id_field_from_hit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_id_field_from_hit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.calculate_searchtime_stats" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;calculate_searchtime_stats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.execute_queries" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;execute_queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.write_csv" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;write_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.log_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;log_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vespa.evaluation.extract_features_from_hit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;extract_features_from_hit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Evaluation</h1>

<div class="doc doc-object doc-module">



<h2 id="vespa.evaluation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>vespa.evaluation</code>


</h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="vespa.evaluation.RandomHitsSamplingStrategy" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>RandomHitsSamplingStrategy</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enum for different random hits sampling strategies.</p>
<ul>
<li>RATIO: Sample random hits as a ratio of relevant docs (e.g., 1.0 = equal number, 2.0 = twice as many)</li>
<li>FIXED: Sample a fixed number of random hits per query</li>
</ul>











  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="vespa.evaluation.VespaEvaluatorBase" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">VespaEvaluatorBase</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">,</span> <span class="n">vespa_query_fn</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">id_field</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">write_csv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">csv_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for Vespa evaluators providing initialization and interface.</p>











  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaEvaluatorBase.run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Abstract method to be implemented by subclasses.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaEvaluatorBase.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Make the evaluator callable.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="vespa.evaluation.VespaEvaluator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">VespaEvaluator</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">,</span> <span class="n">vespa_query_fn</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">id_field</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">accuracy_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">precision_recall_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">mrr_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ndcg_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">map_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">write_csv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">csv_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              VespaEvaluatorBase(queries, relevant_docs, vespa_query_fn, app, name='', id_field='', write_csv=False, csv_dir=None) (vespa.evaluation.VespaEvaluatorBase)" href="#vespa.evaluation.VespaEvaluatorBase">VespaEvaluatorBase</a></code></p>


        <p>Evaluate retrieval performance on a Vespa application.</p>
<p>This class:</p>
<ul>
<li>Iterates over queries and issues them against your Vespa application.</li>
<li>Retrieves top-k documents per query (with k = max of your IR metrics).</li>
<li>Compares the retrieved documents with a set of relevant document ids.</li>
<li>Computes IR metrics: Accuracy@k, Precision@k, Recall@k, MRR@k, NDCG@k, MAP@k.</li>
<li>Logs vespa search times for each query.</li>
<li>Logs/returns these metrics.</li>
<li>Optionally writes out to CSV.</li>
</ul>
<p>Note: The 'id_field' needs to be marked as an attribute in your Vespa schema, so filtering can be done on it.</p>


<details class="example-usage" open>
  <summary>Example usage</summary>
  <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vespa.application</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vespa</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vespa.evaluation</span><span class="w"> </span><span class="kn">import</span> <span class="n">VespaEvaluator</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">queries</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="s2">&quot;q1&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the best GPU for gaming?&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="s2">&quot;q2&quot;</span><span class="p">:</span> <span class="s2">&quot;How to bake sourdough bread?&quot;</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="c1"># ...</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">relevant_docs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="s2">&quot;q1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d12&quot;</span><span class="p">,</span> <span class="s2">&quot;d99&quot;</span><span class="p">},</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="s2">&quot;q2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d101&quot;</span><span class="p">},</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="c1"># ...</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">}</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="c1"># relevant_docs can also be a dict of query_id =&gt; single relevant doc_id</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c1"># relevant_docs = {</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1">#     &quot;q1&quot;: &quot;d12&quot;,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1">#     &quot;q2&quot;: &quot;d101&quot;,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="c1">#     # ...</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="c1"># }</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c1"># Or, relevant_docs can be a dict of query_id =&gt; map of doc_id =&gt; relevance</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="c1"># relevant_docs = {</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="c1">#     &quot;q1&quot;: {&quot;d12&quot;: 1, &quot;d99&quot;: 0.1},</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="c1">#     &quot;q2&quot;: {&quot;d101&quot;: 0.01},</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="c1">#     # ...</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="c1"># Note that for non-binary relevance, the relevance values should be in [0, 1], and that</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="c1"># only the nDCG metric will be computed.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">my_vespa_query_fn</span><span class="p">(</span><span class="n">query_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>        <span class="s2">&quot;yql&quot;</span><span class="p">:</span> <span class="s1">&#39;select * from sources * where userInput(&quot;&#39;</span> <span class="o">+</span> <span class="n">query_text</span> <span class="o">+</span> <span class="s1">&#39;&quot;);&#39;</span><span class="p">,</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>        <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="n">top_k</span><span class="p">,</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>        <span class="s2">&quot;ranking&quot;</span><span class="p">:</span> <span class="s2">&quot;your_ranking_profile&quot;</span><span class="p">,</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="p">}</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Vespa</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="n">evaluator</span> <span class="o">=</span> <span class="n">VespaEvaluator</span><span class="p">(</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    <span class="n">queries</span><span class="o">=</span><span class="n">queries</span><span class="p">,</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="n">relevant_docs</span><span class="o">=</span><span class="n">relevant_docs</span><span class="p">,</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>    <span class="n">vespa_query_fn</span><span class="o">=</span><span class="n">my_vespa_query_fn</span><span class="p">,</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    <span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test-run&quot;</span><span class="p">,</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    <span class="n">accuracy_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>    <span class="n">precision_recall_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>    <span class="n">mrr_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>    <span class="n">ndcg_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>    <span class="n">map_at_k</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>    <span class="n">write_csv</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="n">results</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">()</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Primary metric:&quot;</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">primary_metric</span><span class="p">)</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All results:&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</span></code></pre></div>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>queries</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary where keys are query IDs and values are query strings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relevant_docs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Union">Union</span>[<span title="typing.Set">Set</span>[<span title="str">str</span>], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping query IDs to their relevant document IDs.
Can be a set of doc IDs for binary relevance, a dict of doc_id to relevance score (float between 0 and 1)
for graded relevance, or a single doc_id string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vespa_query_fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="str">str</span>, <span title="int">int</span>, <span title="typing.Optional">Optional</span>[<span title="str">str</span>]], <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function that takes a query string,
the number of hits to retrieve (top_k), and an optional query_id, and returns a Vespa query body dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>app</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="              Vespa(url, port=None, deployment_message=None, cert=None, key=None, vespa_cloud_secret_token=None, output_file=sys.stdout, application_package=None, additional_headers=None) (vespa.application.Vespa)" href="application.html#vespa.application.Vespa">Vespa</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the Vespa application.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A name for this evaluation run. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>id_field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field name in the Vespa hit that contains the document ID.
If empty, it tries to infer the ID from the 'id' field or 'fields.id'. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accuracy_at_k</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k values for which to compute Accuracy@k.
Defaults to [1, 3, 5, 10].</p>
              </div>
            </td>
            <td>
                  <code>[1, 3, 5, 10]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>precision_recall_at_k</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k values for which to compute Precision@k and Recall@k.
Defaults to [1, 3, 5, 10].</p>
              </div>
            </td>
            <td>
                  <code>[1, 3, 5, 10]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mrr_at_k</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k values for which to compute MRR@k. Defaults to [10].</p>
              </div>
            </td>
            <td>
                  <code>[10]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ndcg_at_k</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k values for which to compute NDCG@k. Defaults to [10].</p>
              </div>
            </td>
            <td>
                  <code>[10]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>map_at_k</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k values for which to compute MAP@k. Defaults to [100].</p>
              </div>
            </td>
            <td>
                  <code>[100]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_csv</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to write the evaluation results to a CSV file. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>csv_dir</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the CSV file. Defaults to None (current directory).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>











  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaEvaluator.run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Executes the evaluation by running queries and computing IR metrics.</p>
<p>This method:
1. Executes all configured queries against the Vespa application.
2. Collects search results and timing information.
3. Computes the configured IR metrics (Accuracy@k, Precision@k, Recall@k, MRR@k, NDCG@k, MAP@k).
4. Records search timing statistics.
5. Logs results and optionally writes them to CSV.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing:
- IR metrics with names like "accuracy@k", "precision@k", etc.
- Search time statistics ("searchtime_avg", "searchtime_q50", etc.).
The values are floats between 0 and 1 for metrics and in seconds for timing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="s2">&quot;accuracy@1&quot;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="s2">&quot;ndcg@10&quot;</span><span class="p">:</span> <span class="mf">0.68</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="s2">&quot;searchtime_avg&quot;</span><span class="p">:</span> <span class="mf">0.0123</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="o">...</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">}</span>
</span></code></pre></div>
</details>

    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="vespa.evaluation.VespaMatchEvaluator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">VespaMatchEvaluator</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">,</span> <span class="n">vespa_query_fn</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">id_field</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">rank_profile</span><span class="o">=</span><span class="s1">&#39;unranked&#39;</span><span class="p">,</span> <span class="n">write_csv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">csv_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              VespaEvaluatorBase(queries, relevant_docs, vespa_query_fn, app, name='', id_field='', write_csv=False, csv_dir=None) (vespa.evaluation.VespaEvaluatorBase)" href="#vespa.evaluation.VespaEvaluatorBase">VespaEvaluatorBase</a></code></p>


        <p>Evaluate recall in the match-phase over a set of queries for a Vespa application.</p>
<p>This class:</p>
<ul>
<li>Iterates over queries and issues them against your Vespa application.</li>
<li>Sends one query with limit 0 to get the number of matched documents.</li>
<li>Sends one query with recall-parameter set according to the provided relevant documents.</li>
<li>Compares the retrieved documents with a set of relevant document ids.</li>
<li>Logs vespa search times for each query.</li>
<li>Logs/returns these metrics.</li>
<li>Optionally writes out to CSV.</li>
</ul>
<p>Note: It is recommended to use a rank profile without any first-phase (and second-phase) ranking if you care about speed of evaluation run.
If you do so, you need to make sure that the rank profile you use has the same inputs. For example, if you want to evaluate a YQL query including nearestNeighbor-operator, your rank-profile needs to define the corresponding input tensor.
You must also either provide the query tensor or define it as input (e.g 'input.query(embedding)=embed(@query)') in your Vespa query function.
Also note that the 'id_field' needs to be marked as an attribute in your Vespa schema, so filtering can be done on it.
Example usage:
    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vespa.application</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vespa</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vespa.evaluation</span><span class="w"> </span><span class="kn">import</span> <span class="n">VespaEvaluator</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">queries</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="s2">&quot;q1&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the best GPU for gaming?&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="s2">&quot;q2&quot;</span><span class="p">:</span> <span class="s2">&quot;How to bake sourdough bread?&quot;</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="c1"># ...</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">relevant_docs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="s2">&quot;q1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d12&quot;</span><span class="p">,</span> <span class="s2">&quot;d99&quot;</span><span class="p">},</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="s2">&quot;q2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d101&quot;</span><span class="p">},</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="c1"># ...</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">}</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="c1"># relevant_docs can also be a dict of query_id =&gt; single relevant doc_id</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c1"># relevant_docs = {</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1">#     &quot;q1&quot;: &quot;d12&quot;,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1">#     &quot;q2&quot;: &quot;d101&quot;,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="c1">#     # ...</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="c1"># }</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c1"># Or, relevant_docs can be a dict of query_id =&gt; map of doc_id =&gt; relevance</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="c1"># relevant_docs = {</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="c1">#     &quot;q1&quot;: {&quot;d12&quot;: 1, &quot;d99&quot;: 0.1},</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="c1">#     &quot;q2&quot;: {&quot;d101&quot;: 0.01},</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="c1">#     # ...</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">my_vespa_query_fn</span><span class="p">(</span><span class="n">query_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>        <span class="s2">&quot;yql&quot;</span><span class="p">:</span> <span class="s1">&#39;select * from sources * where userInput(&quot;&#39;</span> <span class="o">+</span> <span class="n">query_text</span> <span class="o">+</span> <span class="s1">&#39;&quot;);&#39;</span><span class="p">,</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>        <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="n">top_k</span><span class="p">,</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>        <span class="s2">&quot;ranking&quot;</span><span class="p">:</span> <span class="s2">&quot;your_ranking_profile&quot;</span><span class="p">,</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="p">}</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Vespa</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="n">evaluator</span> <span class="o">=</span> <span class="n">VespaMatchEvaluator</span><span class="p">(</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>    <span class="n">queries</span><span class="o">=</span><span class="n">queries</span><span class="p">,</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    <span class="n">relevant_docs</span><span class="o">=</span><span class="n">relevant_docs</span><span class="p">,</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    <span class="n">vespa_query_fn</span><span class="o">=</span><span class="n">my_vespa_query_fn</span><span class="p">,</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test-run&quot;</span><span class="p">,</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    <span class="n">id_field</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>    <span class="n">write_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    <span class="n">write_verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="p">)</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="n">results</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">()</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Primary metric:&quot;</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">primary_metric</span><span class="p">)</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All results:&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</span></code></pre></div></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>queries</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary where keys are query IDs and values are query strings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relevant_docs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Union">Union</span>[<span title="typing.Set">Set</span>[<span title="str">str</span>], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping query IDs to their relevant document IDs.
Can be a set of doc IDs for binary relevance, or a single doc_id string.
Graded relevance (dict of doc_id to relevance score) is not supported for match evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vespa_query_fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="str">str</span>, <span title="int">int</span>, <span title="typing.Optional">Optional</span>[<span title="str">str</span>]], <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function that takes a query string,
the number of hits to retrieve (top_k), and an optional query_id, and returns a Vespa query body dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>app</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="              Vespa(url, port=None, deployment_message=None, cert=None, key=None, vespa_cloud_secret_token=None, output_file=sys.stdout, application_package=None, additional_headers=None) (vespa.application.Vespa)" href="application.html#vespa.application.Vespa">Vespa</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the Vespa application.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A name for this evaluation run. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>id_field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field name in the Vespa hit that contains the document ID.
If empty, it tries to infer the ID from the 'id' field or 'fields.id'. Defaults to "".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_csv</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to write the summary evaluation results to a CSV file. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to write detailed query-level results to a separate CSV file.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>csv_dir</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the CSV files. Defaults to None (current directory).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>











  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaMatchEvaluator.create_grouping_filter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">create_grouping_filter</span><span class="p">(</span><span class="n">yql</span><span class="p">,</span> <span class="n">id_field</span><span class="p">,</span> <span class="n">relevant_ids</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Create a grouping filter to append Vespa YQL queries to limit results to relevant documents.
| all( group(id_field) filter(regex("<regex matching all ids>", id_field)) each(output(count())))</p>
<p>Parameters:
yql (str): The base YQL query string.
id_field (str): The field name in the Vespa hit that contains the document ID.
relevant_ids (list[str]): List of relevant document IDs to include in the filter.</p>
<p>Returns:
str: The modified YQL query string with the grouping filter applied.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaMatchEvaluator.extract_matched_ids" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">extract_matched_ids</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">id_field</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Extract matched document IDs from Vespa query response hits.
Parameters:
resp (VespaQueryResponse): The Vespa query response object.
id_field (str): The field name in the Vespa hit that contains the document ID</p>
<p>Returns:
Set[str]: A set of matched document IDs.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaMatchEvaluator.run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Executes the match-phase recall evaluation.</p>
<p>This method:
1. Sends a grouping query to see which of the relevant documents were matched, and get totalCount.
3. Computes recall metrics and match statistics.
4. Logs results and optionally writes them to CSV.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing recall metrics, match statistics, and search time statistics.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="s2">&quot;match_recall&quot;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="s2">&quot;total_relevant_docs&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="s2">&quot;total_matched_relevant&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="s2">&quot;avg_matched_per_query&quot;</span><span class="p">:</span> <span class="mf">45.2</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="s2">&quot;searchtime_avg&quot;</span><span class="p">:</span> <span class="mf">0.015</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="o">...</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">}</span>
</span></code></pre></div>
</details>

    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="vespa.evaluation.VespaCollectorBase" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">VespaCollectorBase</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">,</span> <span class="n">vespa_query_fn</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">id_field</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">csv_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_hits_strategy</span><span class="o">=</span><span class="n">RandomHitsSamplingStrategy</span><span class="o">.</span><span class="n">RATIO</span><span class="p">,</span> <span class="n">random_hits_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max_random_hits_per_query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collect_matchfeatures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collect_rankfeatures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collect_summaryfeatures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract base class for Vespa training data collectors providing initialization and interface.</p>

        <p>Initialize the VespaFeatureCollector.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>queries</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping query IDs to query strings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relevant_docs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Union">Union</span>[<span title="typing.Set">Set</span>[<span title="str">str</span>], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping query IDs to relevant document IDs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vespa_query_fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="str">str</span>, <span title="int">int</span>, <span title="typing.Optional">Optional</span>[<span title="str">str</span>]], <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to generate Vespa query bodies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>app</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="              Vespa(url, port=None, deployment_message=None, cert=None, key=None, vespa_cloud_secret_token=None, output_file=sys.stdout, application_package=None, additional_headers=None) (vespa.application.Vespa)" href="application.html#vespa.application.Vespa">Vespa</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vespa application instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>id_field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field name containing document IDs in Vespa hits (must be defined as an attribute in the schema)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name for this collection run</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>csv_dir</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save CSV files</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_hits_strategy</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="            RandomHitsSamplingStrategy (vespa.evaluation.RandomHitsSamplingStrategy)" href="#vespa.evaluation.RandomHitsSamplingStrategy">RandomHitsSamplingStrategy</a>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strategy for sampling random hits - either "ratio" or "fixed"
- RATIO: Sample random hits as a ratio of relevant docs
- FIXED: Sample a fixed number of random hits per query</p>
              </div>
            </td>
            <td>
                  <code><span title="vespa.evaluation.RandomHitsSamplingStrategy.RATIO">RATIO</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_hits_value</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value for the sampling strategy
- For RATIO: Ratio value (e.g., 1.0 = equal, 2.0 = twice as many random hits)
- For FIXED: Fixed number of random hits per query</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_random_hits_per_query</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional maximum limit on random hits per query
(only applies when using RATIO strategy to prevent excessive sampling)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collect_matchfeatures</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to collect match features</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collect_rankfeatures</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to collect rank features</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collect_summaryfeatures</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to collect summary features</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_csv</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to write results to CSV file</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>











  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaCollectorBase.collect" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">collect</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Abstract method to be implemented by subclasses.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaCollectorBase.__call__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Make the collector callable.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="vespa.evaluation.VespaFeatureCollector" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">VespaFeatureCollector</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">,</span> <span class="n">vespa_query_fn</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">id_field</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">csv_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_hits_strategy</span><span class="o">=</span><span class="n">RandomHitsSamplingStrategy</span><span class="o">.</span><span class="n">RATIO</span><span class="p">,</span> <span class="n">random_hits_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max_random_hits_per_query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collect_matchfeatures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collect_rankfeatures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collect_summaryfeatures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              VespaCollectorBase(queries, relevant_docs, vespa_query_fn, app, id_field, name='', csv_dir=None, random_hits_strategy=RandomHitsSamplingStrategy.RATIO, random_hits_value=1.0, max_random_hits_per_query=None, collect_matchfeatures=True, collect_rankfeatures=False, collect_summaryfeatures=False, write_csv=True) (vespa.evaluation.VespaCollectorBase)" href="#vespa.evaluation.VespaCollectorBase">VespaCollectorBase</a></code></p>


        <p>Collects training data for retrieval tasks from a Vespa application.</p>
<p>This class:</p>
<ul>
<li>Iterates over queries and issues them against your Vespa application.</li>
<li>Retrieves top-k documents per query.</li>
<li>Samples random hits based on the specified strategy.</li>
<li>Compiles a CSV file with query-document pairs and their relevance labels.</li>
</ul>
<p>Important: If you want to sample random hits, you need to make sure that the rank profile you define in your <code>vespa_query_fn</code> has a ranking expression that
reflects this. See <a href="https://docs.vespa.ai/en/tutorials/text-search-ml.html#get-random-hits">docs</a> for example.
In this case, be aware that the <code>relevance_score</code> value in the returned results (or CSV) will be of no value.
This will only have meaning if you use this to collect features for relevant documents only.</p>


<details class="example-usage" open>
  <summary>Example usage</summary>
  <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vespa.application</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vespa</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vespa.evaluation</span><span class="w"> </span><span class="kn">import</span> <span class="n">VespaFeatureCollector</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">queries</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="s2">&quot;q1&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the best GPU for gaming?&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="s2">&quot;q2&quot;</span><span class="p">:</span> <span class="s2">&quot;How to bake sourdough bread?&quot;</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="c1"># ...</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">relevant_docs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="s2">&quot;q1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d12&quot;</span><span class="p">,</span> <span class="s2">&quot;d99&quot;</span><span class="p">},</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="s2">&quot;q2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d101&quot;</span><span class="p">},</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="c1"># ...</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">}</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="k">def</span><span class="w"> </span><span class="nf">my_vespa_query_fn</span><span class="p">(</span><span class="n">query_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        <span class="s2">&quot;yql&quot;</span><span class="p">:</span> <span class="s1">&#39;select * from sources * where userInput(&quot;&#39;</span> <span class="o">+</span> <span class="n">query_text</span> <span class="o">+</span> <span class="s1">&#39;&quot;);&#39;</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        <span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  <span class="c1"># Do not make use of top_k here.</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>        <span class="s2">&quot;ranking&quot;</span><span class="p">:</span> <span class="s2">&quot;your_ranking_profile&quot;</span><span class="p">,</span> <span class="c1"># This should have `random` as ranking expression</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="p">}</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Vespa</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="n">collector</span> <span class="o">=</span> <span class="n">VespaFeatureCollector</span><span class="p">(</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    <span class="n">queries</span><span class="o">=</span><span class="n">queries</span><span class="p">,</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="n">relevant_docs</span><span class="o">=</span><span class="n">relevant_docs</span><span class="p">,</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="n">vespa_query_fn</span><span class="o">=</span><span class="n">my_vespa_query_fn</span><span class="p">,</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>    <span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="n">id_field</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>  <span class="c1"># Field in Vespa hit that contains the document ID (must be an attribute)</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;retrieval-data-collection&quot;</span><span class="p">,</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="n">csv_dir</span><span class="o">=</span><span class="s2">&quot;/path/to/save/csv&quot;</span><span class="p">,</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>    <span class="n">random_hits_strategy</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span>  <span class="c1"># or RandomHitsSamplingStrategy.RATIO</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="n">random_hits_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Sample equal number of random hits to relevant docs</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>    <span class="n">max_random_hits_per_query</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># Optional: cap random hits per query</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    <span class="n">collect_matchfeatures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Collect match features from rank profile</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>    <span class="n">collect_rankfeatures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Skip traditional rank features</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    <span class="n">collect_summaryfeatures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Skip summary features</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="p">)</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="n">collector</span><span class="p">()</span>
</span></code></pre></div>
</details>        <p><strong>Alternative Usage Examples:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Example 1: Fixed number of random hits per query</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">collector</span> <span class="o">=</span> <span class="n">VespaFeatureCollector</span><span class="p">(</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">queries</span><span class="o">=</span><span class="n">queries</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">relevant_docs</span><span class="o">=</span><span class="n">relevant_docs</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">vespa_query_fn</span><span class="o">=</span><span class="n">my_vespa_query_fn</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">id_field</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>  <span class="c1"># Required field name</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">random_hits_strategy</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">random_hits_value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Always sample 50 random hits per query</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="c1"># Example 2: Ratio-based with a cap</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">collector</span> <span class="o">=</span> <span class="n">VespaFeatureCollector</span><span class="p">(</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">queries</span><span class="o">=</span><span class="n">queries</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">relevant_docs</span><span class="o">=</span><span class="n">relevant_docs</span><span class="p">,</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">vespa_query_fn</span><span class="o">=</span><span class="n">my_vespa_query_fn</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">id_field</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>  <span class="c1"># Required field name</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">random_hits_strategy</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">random_hits_value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>  <span class="c1"># Sample twice as many random hits as relevant docs</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="n">max_random_hits_per_query</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>  <span class="c1"># But never more than 200 per query</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="p">)</span>
</span></code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>queries</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary where keys are query IDs and values are query strings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relevant_docs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Union">Union</span>[<span title="typing.Set">Set</span>[<span title="str">str</span>], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping query IDs to their relevant document IDs.
Can be a set of doc IDs for binary relevance, a dict of doc_id to relevance score (float between 0 and 1)
for graded relevance, or a single doc_id string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vespa_query_fn</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="str">str</span>, <span title="int">int</span>, <span title="typing.Optional">Optional</span>[<span title="str">str</span>]], <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function that takes a query string,
the number of hits to retrieve (top_k), and an optional query_id, and returns a Vespa query body dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>app</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="              Vespa(url, port=None, deployment_message=None, cert=None, key=None, vespa_cloud_secret_token=None, output_file=sys.stdout, application_package=None, additional_headers=None) (vespa.application.Vespa)" href="application.html#vespa.application.Vespa">Vespa</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the Vespa application.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>id_field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field name in the Vespa hit that contains the document ID. This field must be defined as an attribute in your Vespa schema.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A name for this data collection run. Defaults to "".</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>csv_dir</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the CSV file. Defaults to None (current directory).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_hits_strategy</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="            RandomHitsSamplingStrategy (vespa.evaluation.RandomHitsSamplingStrategy)" href="#vespa.evaluation.RandomHitsSamplingStrategy">RandomHitsSamplingStrategy</a>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strategy for sampling random hits.
Can be "ratio" (or RandomHitsSamplingStrategy.RATIO) to sample as a ratio of relevant docs,
or "fixed" (or RandomHitsSamplingStrategy.FIXED) to sample a fixed number per query. Defaults to "ratio".</p>
              </div>
            </td>
            <td>
                  <code><span title="vespa.evaluation.RandomHitsSamplingStrategy.RATIO">RATIO</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_hits_value</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value for the sampling strategy.
For RATIO strategy: ratio value (e.g., 1.0 = equal number, 2.0 = twice as many random hits).
For FIXED strategy: fixed number of random hits per query. Defaults to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_random_hits_per_query</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum limit on random hits per query.
Only applies to RATIO strategy to prevent excessive sampling. Defaults to None (no limit).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collect_matchfeatures</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to collect match features defined in rank profile's match-features section. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collect_rankfeatures</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to collect rank features using ranking.listFeatures=true. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collect_summaryfeatures</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to collect summary features from document summaries. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_csv</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to write results to CSV file. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>











  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaFeatureCollector.get_recall_param" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_recall_param</span><span class="p">(</span><span class="n">relevant_doc_ids</span><span class="p">,</span> <span class="n">get_relevant</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Adds the recall parameter to the Vespa query body based on relevant document IDs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>relevant_doc_ids</code>
            </td>
            <td>
                  <code><span title="set">set</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A set of relevant document IDs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>get_relevant</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to retrieve relevant documents.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated Vespa query body with the recall parameter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaFeatureCollector.calculate_random_hits_count" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">calculate_random_hits_count</span><span class="p">(</span><span class="n">num_relevant_docs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate the number of random hits to sample based on the configured strategy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_relevant_docs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of relevant documents for the query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of random hits to sample</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vespa.evaluation.VespaFeatureCollector.collect" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">collect</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Collects training data by executing queries and saving results to CSV.</p>
<p>This method:
1. Executes all configured queries against the Vespa application.
2. Collects the top-k document IDs and their relevance labels.
3. Optionally writes the data to a CSV file for training purposes.
4. Returns the collected data as a single dictionary with results.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict containing:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>'results': List of dictionaries, each containing all data for a query-document pair
(query_id, doc_id, relevance_label, relevance_score, and all extracted features)</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.mean" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the mean of a list of numbers without using numpy.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.percentile" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">percentile</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the p-th percentile of a list of values (0 &lt;= p &lt;= 100).
This approximates numpy.percentile's behavior.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.validate_queries" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">validate_queries</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validate and normalize queries.
Converts query IDs to strings if they are ints.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.validate_qrels" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">validate_qrels</span><span class="p">(</span><span class="n">qrels</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validate and normalize qrels.
Converts query IDs to strings if they are ints.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.validate_vespa_query_fn" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">validate_vespa_query_fn</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validates the vespa_query_fn function.</p>


<details class="the-function-must-be-callable-and-accept-either-2-or-3-parameters" open>
  <summary>The function must be callable and accept either 2 or 3 parameters</summary>
  <ul>
<li>(query_text: str, top_k: int)</li>
<li>or (query_text: str, top_k: int, query_id: Optional[str])</li>
</ul>
</details>        <p>It must return a dictionary when called with test inputs.</p>
<p>Returns True if the function takes a query_id parameter, False otherwise.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.filter_queries" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">filter_queries</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Filter out queries that have no relevant docs</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.extract_doc_id_from_hit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">extract_doc_id_from_hit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">id_field</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract document ID from a Vespa hit.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.get_id_field_from_hit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">get_id_field_from_hit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">id_field</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the ID field from a Vespa hit.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.calculate_searchtime_stats" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">calculate_searchtime_stats</span><span class="p">(</span><span class="n">searchtimes</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate search time statistics.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.execute_queries" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">execute_queries</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">query_bodies</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Execute queries and collect timing information.
Returns the responses and a list of search times.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.write_csv" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">write_csv</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">searchtime_stats</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">,</span> <span class="n">csv_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Write metrics to CSV file.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.log_metrics" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">log_metrics</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Log metrics with appropriate formatting.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vespa.evaluation.extract_features_from_hit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">extract_features_from_hit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">collect_matchfeatures</span><span class="p">,</span> <span class="n">collect_rankfeatures</span><span class="p">,</span> <span class="n">collect_summaryfeatures</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract features from a Vespa hit based on the collection configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hit</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Vespa hit dictionary</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collect_matchfeatures</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to collect match features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collect_rankfeatures</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to collect rank features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collect_summaryfeatures</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to collect summary features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping feature names to values</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>